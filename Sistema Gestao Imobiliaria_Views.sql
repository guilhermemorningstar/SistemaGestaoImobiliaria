DROP DATABASE SISTEMA_GESTAO_IMOBILIARIA;
CREATE DATABASE SISTEMA_GESTAO_IMOBILIARIA;
USE SISTEMA_GESTAO_IMOBILIARIA;

CREATE TABLE TBL_ADM_IMOBILIARIA (
  ID_IMOBILIARIA INT NOT NULL AUTO_INCREMENT,
  ENDERECO VARCHAR(25) NOT NULL,
  CNPJ VARCHAR(25) NOT NULL,
  IE VARCHAR(25) NOT NULL,
  PRIMARY KEY(ID_IMOBILIARIA)
);

CREATE TABLE TBL_PROPRIETARIO (
  ID_PROPRIETARIO INT NOT NULL AUTO_INCREMENT,
  TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA INT NOT NULL,
  ENDERECO VARCHAR(25) NOT NULL,
  RG VARCHAR(25) NOT NULL,
  CPD VARCHAR(25) NOT NULL,
  PRIMARY KEY(ID_PROPRIETARIO),
   CONSTRAINT TBL_PROPRIETARIO_FKIndex1 FOREIGN KEY(TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA) 
   REFERENCES TBL_ADM_IMOBILIARIA(ID_IMOBILIARIA)
);

CREATE TABLE TBL_IMOVEL (
  ID_IMOVEL INT NOT NULL AUTO_INCREMENT,
  TBL_PROPRIETARIO_ID_PROPRIETARIO INT NOT NULL,
  ENDERECO_IMOVEL VARCHAR(25) NOT NULL,
  INSCRICAO_MUNICIPAL_IMOVEL VARCHAR(25) NOT NULL,
  PRIMARY KEY(ID_IMOVEL),
  CONSTRAINT TBL_IMOVEL_FKIndex1 FOREIGN KEY(TBL_PROPRIETARIO_ID_PROPRIETARIO) 
   REFERENCES TBL_PROPRIETARIO(ID_PROPRIETARIO)
);

CREATE TABLE TBL_CLIENTE (
  ID_CLIENTE INT NOT NULL AUTO_INCREMENT,
  TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA INT NOT NULL,
  TBL_IMOVEL_ID_IMOVEL INT NOT NULL,
  NOME_CLIENTE VARCHAR(25) NOT NULL,
  ENDERECO VARCHAR(25) NOT NULL,
  CPF VARCHAR(25) NOT NULL,
  PRIMARY KEY(ID_CLIENTE),
CONSTRAINT TBL_CLIENTE_FKIndex1 FOREIGN KEY(TBL_IMOVEL_ID_IMOVEL) 
REFERENCES TBL_IMOVEL(ID_IMOVEL),
CONSTRAINT TBL_CLIENTE_FKIndex2 FOREIGN KEY(TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA) REFERENCES TBL_ADM_IMOBILIARIA(ID_IMOBILIARIA)
);
 
 CREATE TABLE TBL_CONTATO(
    ID_CONTATO INT NOT NULL AUTO_INCREMENT,
    TBL_PROPRIETARIO_ID_PROPRIETARIO INT NOT NULL,
    TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA INT NOT NULL,
    TBL_CLIENTE_ID_CLIENTE INT NOT NULL,
    TBL_CLIENTE_TBL_IMOVEL_ID_IMOVEL INT NOT NULL,
    TEL1 VARCHAR(25) NOT NULL,
    TEL2 VARCHAR(25) NOT NULL,
    CONSTRAINT TBL_CONTATO_FKIndex1 foreign key(TBL_PROPRIETARIO_ID_PROPRIETARIO) 
    REFERENCES TBL_PROPRIETARIO(ID_PROPRIETARIO),
    CONSTRAINT TBL_CONTATO_FKIndex2 FOREIGN KEY (TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA) 
    REFERENCES TBL_ADM_IMOBILIARIA(ID_IMOBILIARIA),
    CONSTRAINT TBL_CONTATO_FKIndex3 FOREIGN KEY (TBL_CLIENTE_ID_CLIENTE) 
    REFERENCES TBL_CLIENTE(ID_CLIENTE),
    CONSTRAINT TBL_CONTATO_FKIndex4 FOREIGN KEY (TBL_CLIENTE_TBL_IMOVEL_ID_IMOVEL)
    REFERENCES TBL_CLIENTE(TBL_IMOVEL_ID_IMOVEL),
    PRIMARY KEY(ID_CONTATO)
 );
 
INSERT INTO TBL_ADM_IMOBILIARIA (endereco,cnpj,ie)
VALUES('Rua Jose Alves','13.171.058/0001-40','388.158.598.269');

INSERT INTO TBL_ADM_IMOBILIARIA (endereco,cnpj,ie)
VALUES('Rua Antonio Vilela','15.161.038/0001-40','389.108.598.269');

INSERT INTO TBL_ADM_IMOBILIARIA (endereco,cnpj,ie)
VALUES('Rua Santo Amado','17.251.020/0001-40','388.132.598.269');

INSERT INTO TBL_PROPRIETARIO (tbl_adm_imobiliaria_id_imobiliaria,endereco,rg,cpd)
VALUES(1,'Rua Andrade Alves','00000025487987-2','Data-Center');

INSERT INTO TBL_PROPRIETARIO (tbl_adm_imobiliaria_id_imobiliaria,endereco,rg,cpd)
VALUES(2,'Rua Roberto Carlos','00000025487988-2','Data-Center');

INSERT INTO TBL_PROPRIETARIO (tbl_adm_imobiliaria_id_imobiliaria,endereco,rg,cpd)
VALUES(3,'Rua Lucas Lima','00000025487997-2','Data-Center');

INSERT INTO TBL_IMOVEL (tbl_proprietario_id_proprietario,endereco_imovel,inscricao_municipal_imovel)
VALUES(1,'Rua Alexandre Mattos','57845698');

INSERT INTO TBL_IMOVEL (tbl_proprietario_id_proprietario,endereco_imovel,inscricao_municipal_imovel)
VALUES(2,'Rua Lucas santos','77845698');

INSERT INTO TBL_IMOVEL (tbl_proprietario_id_proprietario,endereco_imovel,inscricao_municipal_imovel)
VALUES(3,'Rua alvarez','97845698');

INSERT INTO TBL_CLIENTE (tbl_adm_imobiliaria_id_imobiliaria,tbl_imovel_id_imovel,nome_cliente,endereco,cpf)
VALUES (1,2,'Eduardo','Rua Joao da Fonseca','24589359874');

INSERT INTO TBL_CLIENTE (tbl_adm_imobiliaria_id_imobiliaria,tbl_imovel_id_imovel,nome_cliente,endereco,cpf)
VALUES (2,2,'Joao','Rua Andrade','24589359874');

INSERT INTO TBL_CLIENTE (tbl_adm_imobiliaria_id_imobiliaria,tbl_imovel_id_imovel,nome_cliente,endereco,cpf)
VALUES (3,3,'Diego','Rua Carlos Augusto ','34589359874');

INSERT INTO TBL_CONTATO (tbl_proprietario_id_proprietario,tbl_adm_imobiliaria_id_imobiliaria,tbl_cliente_id_cliente,tbl_cliente_tbl_imovel_id_imovel,tel1,tel2)
VALUES (1,3,2,2,'(11)56627822','(11)56623654');

INSERT INTO TBL_CONTATO (tbl_proprietario_id_proprietario,tbl_adm_imobiliaria_id_imobiliaria,tbl_cliente_id_cliente,tbl_cliente_tbl_imovel_id_imovel,tel1,tel2)
VALUES (3,3,1,3,'(11)56633369','(11)56637124');

INSERT INTO TBL_CONTATO (tbl_proprietario_id_proprietario,tbl_adm_imobiliaria_id_imobiliaria,tbl_cliente_id_cliente,tbl_cliente_tbl_imovel_id_imovel,tel1,tel2)
VALUES (2,1,3,3,'(11)65489897','(11)45623158');

CREATE VIEW VW_TBLADMIMOBILIARIA
AS SELECT IE, ENDERECO
FROM TBL_ADM_IMOBILIARIA
WHERE IE = 350;

CREATE VIEW VW_TBLPROPRIETARIO
AS SELECT ENDERECO
FROM TBL_PROPRIETARIO
WHERE CPD = 'Data-Center';

CREATE VIEW VW_TBLIMOVEL
AS SELECT INSCRICAO_MUNICIPAL_IMOVEL
FROM TBL_IMOVEL
WHERE INSCRICAO_MUNICIPAL_IMOVEL LIKE '3%';

CREATE VIEW VW_TBLCLIENTE
AS SELECT NOME_CLIENTE, CPF
FROM TBL_CLIENTE
ORDER BY NOME_CLIENTE;

CREATE VIEW VW_TBLCONTATO
AS SELECT TEL1, TEL2
FROM TBL_CONTATO
WHERE TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA = 1;

SELECT * FROM TBL_CONTATO;
SELECT ENDERECO, RG
FROM TBL_PROPRIETARIO
WHERE TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA = 3;

SELECT A.ENDERECO, A.CNPJ, B.NOME_CLIENTE
FROM TBL_ADM_IMOBILIARIA AS A
INNER JOIN TBL_CLIENTE AS B
ON A.ID_IMOBILIARIA = B.TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA;

SELECT TEL1, TEL2
FROM TBL_CONTATO
WHERE TEL1 OR TEL2 LIKE '%5661%';

SELECT *
FROM TBL_CLIENTE
ORDER BY ENDERECO;

SELECT ENDERECO, SUM(IE) AS 'INSCRICÃƒO ESTADUAL'
FROM TBL_ADM_IMOBILIARIA
GROUP BY ENDERECO;

SELECT *
FROM TBL_PROPRIETARIO
ORDER BY RG DESC;

SELECT *
FROM TBL_PROPRIETARIO
ORDER BY RG ASC;

SELECT TBL_ADM_IMOBILIARIA.ID_IMOBILIARIA, TBL_CLIENTE.NOME_CLIENTE
FROM TBL_ADM_IMOBILIARIA, TBL_CLIENTE
WHERE TBL_ADM_IMOBILIARIA.ID_IMOBILIARIA = TBL_CLIENTE.TBL_ADM_IMOBILIARIA_ID_IMOBILIARIA AND  TBL_CLIENTE.TBL_IMOVEL_ID_IMOVEL > 5.00;

SHOW TABLES;
describe tbl_adm_imobiliaria;
describe tbl_proprietario;
describe tbl_imovel; 
describe tbl_cliente;
describe tbl_contato;

select * from vw_tbladmimobiliaria;
select * from vw_tblcontato;
select * from vw_tblproprietario;
select * from vw_tblimovel;
select * from vw_tblcliente;
